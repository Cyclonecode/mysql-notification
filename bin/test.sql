DROP DATABASE IF EXISTS mysql_note;

CREATE DATABASE mysql_note;

USE mysql_note;

CREATE TABLE post (
	id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	title VARCHAR(64) NOT NULL,
	content TEXT DEFAULT NULL,
	image VARCHAR(260) DEFAULT NULL
);

DROP FUNCTION IF EXISTS MySQLNotification;
CREATE FUNCTION MySQLNotification RETURNS INTEGER SONAME 'mysql-notification.so';

DELIMITER @@

DROP TRIGGER IF EXISTS trigger1;
CREATE TRIGGER trigger1 AFTER INSERT ON post
FOR EACH ROW
BEGIN
  SELECT MySQLNotification(NEW.id, 2) INTO @x;
END@@

DROP TRIGGER IF EXISTS trigger2;
CREATE TRIGGER trigger2 AFTER UPDATE ON post
FOR EACH ROW
BEGIN
  SELECT MySQLNotification(NEW.id, 3) INTO @x;
END@@

DROP TRIGGER IF EXISTS trigger3;
CREATE TRIGGER trigger3 AFTER DELETE ON post
FOR EACH ROW
BEGIN
  SELECT MySQLNotification(OLD.id, 4) INTO @x;
END@@

DELIMITER ;
